<script src="https://koda.nu/simple.js">

  // Map array
  const mapArray = [[0,1,"grass"],[1,1,"grass"],[2,1,"grass"],[3,1,"grass"],[4,1,"grass"]];
  const blockSize = 63.1;
  
  // Scaling (10 blocks tall)
  const scale_factor = blockSize * 10 / totalHeight;
  scale(1 / scale_factor,1 / scale_factor);
  
  // Assets
  const bricksUrl = "https://cdn.discordapp.com/attachments/489085929726935041/616212100481679368/block.png";
  const grassUrl = "https://cdn.discordapp.com/attachments/489085929726935041/616702235484618754/flatgrass.png";
  
  class player {
    constructor(picArray, respawnX, respawnY) {
      this.x = respawnX;
      this.y = respawnY;
      this.xv = 0;
      this.yv = 0;
      this.touching_ground = false;
      this.state = 1;
    }
    
    // Function that checks if any block is within range to collide
    static checkCollision() {
      // For every block
      for (var i = 0; i < mapArray.length; i++) {
        // If in range
        if (abs(this.x / blockSize - mapArray[i][0]) < blockSize * 3 && abs(this.y / blockSize - mapArray[i][1]) < 3) {
          //Perform collision
        	
        }
      }
    }
    
    // Performs collision by detecting what side of the block was impacted and adjusting the character velocity
    static performCollision(blockX,blockY) {
      // Calculate delta in coming tick
      var dx_next = abs(this.x + this.xv - blockX);
      var dy_next = abs(this.y + this.yv - blockY);
      
      // Calculate pos in coming tick
      var x_next = this.x - blockX;
      var y_next = this.y - blockY;
      
      // Calculate delta in current tick
      var dx = abs(this.x - blockX);
      var dy = abs(this.y - blockY);
      
      // If not going to collide, don't perform calculation
      if (dy_next > blockSize && dx_next > blockSize) {
        return null
      }
      
      if (y_next + blockSize > blockY && this.y < y_next) {
          
        // Top
        this.yv = dy-blockSize;
        this.touching_ground = true;
          
      }else if (y_next < blockY + blockSize && this.y > y_next && y_next > blockY) {
          
        // Bottom
        this.yv = -dy+blockSize;
          
      }else if (x_next + blockSize > blockX && this.x < posX) {
          
        // Left
        this.yv = -dy+blockSize;
            
      }else if (x_next < blockX + blockSize && this.x > posX) {
          
        // Right
        this.xv = dx-blockSize;
          
      }
    }

    static render() {
      var url;

      if (this.state == 1) {
        url
      }
      image();
    }
  }
  
  
  
  
  
  function drawMap() {
  	// Go through every block
    for (var i = 0; i < mapArray.length; i++) {
      var url;
      if (mapArray[i][2] == "grass") {
        url = grassUrl      
      }else if (mapArray[i][2] == "bricks") {
        url = bricksUrl
      }
      picture(mapArray[i][0] * blockSize, totalHeight * scale_factor - blockSize * mapArray[i][1],url);
    }
  }
  
  function update() {
  	clearScreen();
  	drawMap();
  }
  

</script>